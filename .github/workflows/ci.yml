name: Continuous integration
on: [push, pull_request]

jobs:
    check-formatting:
        name: Check formatting
        uses: edpft/rust-workflows/.github/workflows/check-formatting.yml@main
    
    lint:
        name: Lint
        uses: edpft/rust-workflows/.github/workflows/lint.yml@main
    
    test:
        name: Test
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repo
              uses: actions/checkout@v3
            - name: Install dependencies
              run: |
                apt-get update && apt-get install \
                    openjdk-17-jdk \
                    graphviz \
                    gnuplot
            - name: Install Maelstrom 
              run: |
                wget https://github.com/jepsen-io/maelstrom/releases/download/v0.2.3/maelstrom.tar.bz2
                tar -xf maelstrom.tar.bz2
                rm -rf maelstrom.tar.bz2
            - name: Install Rust
              uses: dtolnay/rust-toolchain@v1
              with:
                toolchain: stable
            - name: Run tests
              run: |
                cargo test

                 